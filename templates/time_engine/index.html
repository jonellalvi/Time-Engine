<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Time Engine</title>

    <!-- FullCalendar stylesheet -->
    <link rel='stylesheet' href='//cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.2.3/fullcalendar.min.css'/>
    {% load staticfiles %}
    <!-- Bootstrap Core CSS -->
    <link href="{% static 'time_engine/css/bootstrap.min.css' %}" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="{% static 'time_engine/css/shop-item.css' %}" rel="stylesheet">
    <link href="{% static 'time_engine/css/index.css' %}" rel="stylesheet">
    <link href="{% static 'time_engine/css/panels.css' %}" rel="stylesheet">

    <!-- jQueryUI CSS -->
    <link rel="stylesheet" href="{% static 'time_engine/css/jquery-ui.min.css' %}">
    <!--<script src="external/jquery/jquery.js"></script>-->


</head>

<body>

<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!-- brand logo -->
            <a class="navbar-brand" href="#">Time Engine</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse pull-right" id="bs-example-navbar-collapse-1">
            <!-- list of nav bar items -->
            <ul class="nav navbar-nav">
                <!-- About -->
                <li>
                    <a href="#">About</a>
                </li>
                <!-- Help -->
                <li>
                    <!-- Help button -->
                    <button type="button" class="btn btn-primary navbar-btn" data-toggle="modal"
                            data-target=".modal-help">Help
                    </button>
                    <!-- Help Modal -->
                    <div class="modal fade modal-help" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <!-- "x" to dismiss modal -->
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <!-- Help modal header-->
                                    <h4 class="modal-title" id="myLargeModalLabel">Welcome to Time Engine Help!</h4>
                                </div>
                                <!-- Help modal body -->
                                <div class="modal-body">
                                    <p>Here is a discussion of Time Engine</p>
                                </div><!-- help modal-body -->
                            </div><!-- help modal-content -->
                        </div><!-- help modal-dialog -->
                    </div><!-- help modal-fade -->
                </li>
                <!-- Sign In -->
                <li>
                    <!-- Sign In Modal -->
                    <!-- IF USER IS NOT AUTHENTICATED, DISPLAY THE LOGIN BUTTON. -->
                    {% if not user.is_authenticated %}
                        <button type="button" class="btn btn-primary navbar-btn" data-toggle="modal"
                                data-target=".modal-signin">
                            Sign In
                        </button>
                        <!-- Sign in Modal -->
                        <div class="modal fade modal-signin" tabindex="-1" role="dialog"
                             aria-labelledby="myLargeModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <!-- Sign in modal body -->
                                    <div class="modal-body" id="modal-signin">
                                        <!-- "x" to dismiss sign in modal -->
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                        <!-- Sign in modal header -->
                                        <h1 class="text-center login-title">Sign in to the Time Engine</h1>
                                        <hr>
                                        <!-- Sign in Form -->
                                        <form class="form-horizontal" method="post" action="/time_engine/login/">
                                            {% csrf_token %}
                                            <fieldset>
                                                <!-- Sign in Username Email input-->
                                                <div class="form-group">
                                                    <label class="col-md-4 control-label" for="email">Email:</label>
                                                    <div class="col-md-5">
                                                        <input id="username" name="username" type="text"
                                                               placeholder="Enter your Email"
                                                               class="form-control input-md" required="">
                                                    </div><!-- Sign in col-md-5 -->
                                                </div><!-- Sign in email form-group -->

                                                <!-- Sign in Password input-->
                                                <div class="form-group">
                                                    <label class="col-md-4 control-label"
                                                           for="password">Password:</label>
                                                    <div class="col-md-5">
                                                        <input id="password" name="password" type="password"
                                                               placeholder="Enter your Password"
                                                               class="form-control input-md" required="">

                                                    </div>
                                                </div><!-- Sign in password form-group -->

                                                <!-- Sign in button -->
                                                <div class="form-group">
                                                    <label class="col-md-4 control-label" for="login"></label>
                                                    <div class="col-md-4">
                                                        <button id="login" name="login" class="btn btn-primary">Sign
                                                            In
                                                        </button>
                                                    </div><!-- Sign in col-md-4 -->
                                                </div><!-- Sign in button form-group -->
                                                <hr>

                                                <!-- Link to create an account -->
                                                <div class="form-group">
                                                    <div class="col-md-12 text-center">
                                                        <a href="#" id="register-link">Create an account </a>
                                                    </div><!-- create an account col-md-12 -->
                                                </div><!-- create an account form-group -->
                                            </fieldset>
                                        </form><!-- Sign in form -->
                                    </div><!-- Sign in modal body-->

                                    <!-- Register modal -->
                                    <div class="modal-body" id="modal-register">
                                        <!-- "x" to dismiss register modal -->
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                        <h1 class="text-center login-title">Register for the Time Engine</h1>
                                        <hr>
                                        <!-- Register form -->
                                        <form id="register-form" class="form-horizontal" method="post"
                                              action="/time_engine/register/">
                                            {% csrf_token %}
                                            <fieldset>
                                                <!-- Register Username Email input-->
                                                <div class="form-group">
                                                    <label class="col-md-4 control-label" for="email">Email:</label>
                                                    <div class="col-md-5">
                                                        <input id="reg_username" name="username" type="text"
                                                               placeholder="Enter your Email"
                                                               class="form-control input-md" required="">
                                                    </div><!-- register email col-md-5 -->
                                                </div><!-- register email form-group -->

                                                <!-- Register Password input-->
                                                <div class="form-group">
                                                    <label class="col-md-4 control-label"
                                                           for="password">Password:</label>
                                                    <div class="col-md-5">
                                                        <input id="reg_password" name="password" type="password"
                                                               placeholder="Enter your Password"
                                                               class="form-control input-md" required="">
                                                    </div><!-- register password col-md-5 -->
                                                </div><!-- register password form-group -->

                                                <!-- Register Button -->
                                                <div class="form-group">
                                                    <label class="col-md-4 control-label" for="login"></label>
                                                    <div class="col-md-5">
                                                        <button id="register-button" name="register"
                                                                class="btn btn-danger">Register
                                                        </button>
                                                        <!-- return to sigin link -->
                                                        <a href="#" class="pull-right" id="signin-link">Back To Sign In</a>
                                                    </div><!-- register button col-md-5 -->
                                                </div><!-- register button form-group -->
                                            </fieldset>
                                        </form><!-- Register Form -->
                                    </div><!-- Register modal-body -->

                                </div><!--modal-content-->
                            </div><!--modal-dialog-->
                        </div><!-- Main modal -->
                    <!-- END if user is not authenticated -->
                    {% else %}
                        <!-- IF USER IS AUTHENTICATED-->
                        <!-- Bootstrap split button dropdown menu-->
                        <div class="btn-group">
                            <!-- Welcome button -->
                            <button type="button" class="btn btn-default navbar-btn">Welcome {{ user.username }}!
                            </button>
                            <button type="button" class="btn btn-default navbar-btn dropdown-toggle"
                                    data-toggle="dropdown" aria-expanded="false">
                                <span class="caret"></span>
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <!-- User Dropdown menu -->
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuDivider">
                                <!-- View Profile option -->
                                <li role="presentation">
                                    <!-- Link to Profile menu TODO: Add Profile modal -->
                                    <a role="menuitem" tabindex="-1" href="#">
                                        <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                                        View Profile
                                    </a>
                                </li>
                                <!-- View Settings -->
                                <li role="presentation">
                                    <a role="menuitem" tabindex="-1" href="#">
                                        <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
                                        Settings
                                    </a>
                                </li>
                                <li role="presentation" class="divider"></li>
                                <!-- Sign Out link -->
                                <li role="presentation">
                                    <a role="menuitem" tabindex="-1" href="/time_engine/logout/">
                                        Sign Out
                                    </a>
                                </li>
                            </ul><!-- User Dropdown menu -->
                        </div><!-- end btn-group -->
                    {% endif %}{# user authentication #}
                </li><!-- Sign in nav item -->
            </ul><!-- list of nav bar items -->
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-md-12">
        <div class="thumbnail">
            <!--TITLE ROW -->
            <div class="row">
                <h2 class="page-header"> Welcome to the Time Engine </h2>
            </div>
            <!-- CALENDAR ROW -->
            <div class="row">
                <!-- display jQuery Full Calendar -->
                <div id="calendarContainer">
                </div>
            </div><!-- END Calendar row -->
            <!--  Time Table ROW -->
            <div class="row">
                <div class="caption-full">
                    <div class="text-left">
                        <!-- New Timetable Button -->
                        <button class="btn btn-primary" type="button" data-toggle="collapse"
                                data-target="#collapseTimetable" aria-expanded="false" aria-controls="collapseTimetable">
                            New Timetable
                        </button>
                    </div><!-- timetable button text-left -->
                </div><!-- timetable button caption-full-->
            </div><!-- END Timetable ROW -->

            <!--Time Tables forms row-->
            <div class="row">
                <div class="collapse" id="collapseTimetable">
                    <div class="well">
                        <!--New Timetable FORM-->
                        <form id="newForm" method="post" class="form-horizontal">
                            {% csrf_token %}
                            <h2 class="page-header">Create a new Timetable</h2>

                            <!--hidden input for indicating a save to db-->
                            <input class="save" id="id_save" name="save" type="hidden"/>

                            <!--Timetable Name field-->
                            <div class="form-group">
                                <label class="control-label col-xs-3" for="name">Name:</label>
                                <div class="col-xs-9">
                                    <input type="text" class="form-control" id="name" placeholder="Time table name"
                                           maxlength="100" name="name">
                                </div><!-- timetable form name col-xs-9 -->
                            </div><!-- timetable name form-group -->

                            <!--Timetable Color choice radios-->
                            <div class="form-group">
                                <label class="control-label col-xs-3">Color:</label>
                                <!-- Blue -->
                                <div class="col-xs-2">
                                    <label class="radio-inline">
                                        <input type="radio" name="color" value="blue"> Blue
                                    </label>
                                </div>
                                <!-- Green -->
                                <div class="col-xs-2">
                                    <label class="radio-inline">
                                        <input type="radio" name="color" value="green"> Green
                                    </label>
                                </div>
                                <!-- Red -->
                                <div class="col-xs-2">
                                    <label class="radio-inline">
                                        <input type="radio" name="color" value="red"> Red
                                    </label>
                                </div>
                                <!-- Purple -->
                                <div class="col-xs-2">
                                    <label class="radio-inline">
                                        <input type="radio" name="color" value="purple"> Purple
                                    </label>
                                </div>
                            </div><!-- Timetable color choice radios form-group -->


                            <!--Timetable Start date widget group-->
                            <div class="form-group">
                                <label class="control-label col-xs-3">Start Date:</label>
                                <!--Start month-->
                                <div class="col-xs-3">
                                    <select class="form-control" name="start_date_month">
                                        <option selected="selected">Month</option>
                                        <option value="1">January</option>
                                        <option value="2">February</option>
                                        <option value="3">March</option>
                                        <option value="4">April</option>
                                        <option value="5">May</option>
                                        <option value="6">June</option>
                                        <option value="7">July</option>
                                        <option value="8">August</option>
                                        <option value="9">September</option>
                                        <option value="10">October</option>
                                        <option value="11">November</option>
                                        <option value="12">December</option>
                                    </select>
                                </div>
                                <!--Start Date-->
                                <div class="col-xs-3">
                                    <select class="form-control" name="start_date_day">
                                        <option selected="selected">Date</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                        <option value="13">13</option>
                                        <option value="14">14</option>
                                        <option value="15">15</option>
                                        <option value="16">16</option>
                                        <option value="17">17</option>
                                        <option value="18">18</option>
                                        <option value="19">19</option>
                                        <option value="20">20</option>
                                        <option value="21">21</option>
                                        <option value="22">22</option>
                                        <option value="23">23</option>
                                        <option value="24">24</option>
                                        <option value="25">25</option>
                                        <option value="26">26</option>
                                        <option value="27">27</option>
                                        <option value="28">28</option>
                                        <option value="29">29</option>
                                        <option value="30">30</option>
                                        <option value="31">31</option>
                                    </select>
                                </div>
                                <!--start year-->
                                <div class="col-xs-3">
                                    <select class="form-control" name="start_date_year">
                                        <option selected="selected">Year</option>
                                        <option value="2015">2015</option>
                                        <option value="2016">2016</option>
                                        <option value="2017">2017</option>
                                        <option value="2018">2018</option>
                                        <option value="2019">2019</option>
                                        <option value="2020">2020</option>
                                    </select>
                                </div>
                            </div><!--end start date form group-->

                            <!--Start time field-->
                            <div class="form-group">
                                <label class="control-label col-xs-3">Start Time:</label>
                                <div class="col-xs-3">
                                    <select class="form-control" name="start_time">
                                        <option selected="selected">Time</option>
                                        <option value="12:00">12:00am</option>
                                        <option value="12:30">12:30am</option>
                                        <option value="1:00">1:00am</option>
                                        <option value="1:30">1:30am</option>
                                        <option value="2:00">2:00am</option>
                                        <option value="2:30">2:30am</option>
                                        <option value="3:00">3:00am</option>
                                        <option value="3:30">3:30am</option>
                                        <option value="4:00">4:00am</option>
                                        <option value="4:30">4:30am</option>
                                        <option value="5:00">5:00am</option>
                                        <option value="5:30">5:30am</option>
                                        <option value="6:00">6:00am</option>
                                        <option value="6:30">6:30am</option>
                                        <option value="7:00">7:00am</option>
                                        <option value="7:30">7:30am</option>
                                        <option value="8:00">8:00am</option>
                                        <option value="8:30">8:30am</option>
                                        <option value="9:00">9:00am</option>
                                        <option value="9:30">9:30am</option>
                                        <option value="10:00">10:00am</option>
                                        <option value="10:30">10:30am</option>
                                        <option value="11:00">11:00am</option>
                                        <option value="11:30">11:30am</option>
                                        <option value="12:00">12:00pm</option>
                                        <option value="12:30">12:30pm</option>
                                        <option value="13:00">1:00pm</option>
                                        <option value="13:30">1:30pm</option>
                                        <option value="14:00">2:00pm</option>
                                        <option value="14:30">2:30pm</option>
                                        <option value="15:00">3:00pm</option>
                                        <option value="15:30">3:30pm</option>
                                        <option value="16:00">4:00pm</option>
                                        <option value="16:30">4:30pm</option>
                                        <option value="17:00">5:00pm</option>
                                        <option value="17:30">5:30pm</option>
                                        <option value="18:00">6:00pm</option>
                                        <option value="18:30">6:30pm</option>
                                        <option value="19:00">7:00pm</option>
                                        <option value="19:30">7:30pm</option>
                                        <option value="20:00">8:00pm</option>
                                        <option value="20:30">8:30pm</option>
                                        <option value="21:00">9:00pm</option>
                                        <option value="21:30">9:30pm</option>
                                        <option value="22:00">10:00pm</option>
                                        <option value="22:30">10:30pm</option>
                                        <option value="23:00">11:00pm</option>
                                        <option value="23:30">11:30pm</option>
                                    </select>
                                </div>
                            </div><!-- Timetable Start Time field -->

                            <!--Timetable Total events field -->
                            <div class="form-group">
                                <label class="control-label col-xs-3" for="event_count">Total events:</label>
                                <div class="col-xs-3">
                                    <input name="event_count" type="number" class="form-control" id="event_count"
                                           placeholder="Enter a number...">
                                </div>
                            </div><!-- Timetable total events field -->

                            <!--Available days form group-->
                            <div class="form-group">
                                <label class="control-label col-xs-3">Available Days:</label>
                                <!-- Sunday -->
                                <div class="col-xs-1">
                                    <label class="checkbox-inline">
                                        <input type="checkbox" name="has_sunday"> Sun
                                    </label>
                                </div>
                                <!-- Monday -->
                                <div class="col-xs-1">
                                    <label class="checkbox-inline">
                                        <input type="checkbox" name="has_monday"> Mon
                                    </label>
                                </div>
                                <!-- Tuesday -->
                                <div class="col-xs-1">
                                    <label class="checkbox-inline">
                                        <input type="checkbox" name="has_tuesday"> Tues
                                    </label>
                                </div>
                                <!-- Wednesday -->
                                <div class="col-xs-1">
                                    <label class="checkbox-inline">
                                        <input type="checkbox" name="has_wednesday"> Wed
                                    </label>
                                </div>
                                <!-- Thursday -->
                                <div class="col-xs-1">
                                    <label class="checkbox-inline">
                                        <input type="checkbox" name="has_thursday"> Thurs
                                    </label>
                                </div>
                                <!-- Friday -->
                                <div class="col-xs-1">
                                    <label class="checkbox-inline">
                                        <input type="checkbox" name="has_friday"> Fri
                                    </label>
                                </div>
                                <!-- Saturday -->
                                <div class="col-xs-1">
                                    <label class="checkbox-inline">
                                        <input type="checkbox" name="has_saturday"> Sat
                                    </label>
                                </div>
                            </div><!-- Timetable Available Days form group-->

                            <!-- Timetable End date field -->
                            <div class="form-group">
                                <label id="end_date_label" class="control-label col-xs-3" for="end_date"></label>
                                <div class="col-xs-9" id="end_date_div">
                                    <span id="end_date"></span>
                                </div>
                            </div><!-- End Date Field -->

                            <br>
                            <!--Timetable form buttons-->
                            <div class="form-group ">
                                <hr>
                                <div class="col-xs-offset-3 col-xs-9 ">
                                    <!-- Reset button -->
                                    <input type="reset" class="btn btn-default" id='reset2' value="Reset">
                                    <!-- Run button -->
                                    <input type="submit" class="btn btn-primary" id='run' value="Run">
                                    <!-- If user isn't signed in, disable the save button -->
                                    {% if not user.is_authenticated %}
                                        <input type="submit" class="btn btn-primary" title="Sign In to Save" disabled
                                               id='save' value="Save">
                                    {% else %}
                                        <input type="submit" class="btn btn-primary" id='save' value="Save">
                                    {% endif %}
                                </div>
                            </div><!-- Timetable form buttons form-group -->

                        </form><!-- New Timetable form -->
                    </div><!--.well-->
                </div><!--.collapse-->
            </div><!--.row-->


            <!--timetable cards-->
            <div class="row">

                {%  for timetable in timetables %}
                <!--this is a single timetable-->
                <div class="col-sm-4 col-md-4">

                    <div class="thumbnail">

                        <div class="caption">

                            <h4>
                                <div style="display: inline-block; width: 18px; height: 18px; background: {{ timetable.color }};"></div>
                                {{ timetable.name }}
                            </h4>

                            <div class="row">
                                <div class="col-sm-12">
                                    <strong>Start Date:</strong> {{ timetable.start_date }}<br>
                                    <strong>Time:</strong> {{ timetable.start_time }}<br>
                                    <strong>Events:</strong> {{ timetable.event_count }}<br>
                                    <strong>Days: </strong>
                                        {% if timetable.has_monday %} M {% endif %}
                                        {% if timetable.has_tuesday %} Tu {% endif %}
                                        {% if timetable.has_wednesday %} W {% endif %}
                                        {% if timetable.has_thursday %} Th {% endif %}
                                        {% if timetable.has_friday %} F {% endif %}
                                        {% if timetable.has_saturday %} Sa {% endif %}
                                        {% if timetable.has_sunday %} Su {% endif %}
                                        <br>
                                    <strong>End: </strong> {{ timetable.end_date }}<br>
                                    <br>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-12">
                                    <input type="checkbox" title="Check to show the timetable on the calendar"> Display
                                    <!--<a href="#" class="btn btn-default btn-xs pull-right" role="button">Delete</a>-->
                                    <button class="btn btn-default btn-xs pull-right delbtn" type="button" role="button" data-ttid="{{  timetable.id }}">Delete</button>
                                    <a href="#" class="btn btn-primary btn-xs pull-right" style="margin-right: 4px;"
                                       role="button">Edit</a>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>





            <!--row-->
            <div class="row" id="msg">
                <!--messages go here-->

            </div>
            <!-- row for messages -->
            <div class="row" id="tt_list">
                <!--list of saved timetables goes here-->
            </div>
            <!-- row for saved timetables -->


        </div>
        <!-- END Thumbnail -->
    </div>
    <!-- END columns md 12 -->
    <!--</div>-->
</div>
<!-- /.container -->

<div class="container">

    <hr>

    <!-- Footer -->
    <footer>
        <div class="row">
            <div class="col-lg-12">
                <p>Copyright &copy; Jonell Alvi 2015</p>
            </div>
        </div>
    </footer>

</div>
<!-- /.container -->

<!-- JavaScript stuff -->
<!--my js-->
<script src="{% static 'time_engine/js/formvalidation.js' %}" type="text/javascript"></script>

<!--FullCalendar js files-->
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.2.3/fullcalendar.min.js"></script>

<!-- jQueryUI js -->
<script src="{% static 'time_engine/js/jquery-ui.min.js' %}"></script>


<!-- Bootstrap js -->
<script src="{% static 'time_engine/js/bootstrap.min.js' %}"></script>

<!-- Custom js -->
<script src="{% static 'time_engine/js/panels.js' %}" type="text/javascript"></script>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

<!-- the jquery Full Calendar -->
<script>
    $(document).ready(function () {
        // Initialize calendar
        $('#calendarContainer').fullCalendar({
            //options for fullCalendar go here.
        });

        //setting up the event handler for New Timetable form submission
        $('#run, #save').on('click', function (e) {
            var form_stuff = $("#newForm").serialize();
            //console.log(form_stuff);
            // check whether it is a run or a save
            // and set a toggle to handle in the view.
            if (e.target.id == 'run') {
                form_stuff += '&save=false';
            } else {
                form_stuff += '&save=true';
                //TODO: add panel to list of timetables

            }
            // ajax call for new timetable data
            $.post("/time_engine/", form_stuff, function (data) {
{#                console.log(data);#}
                var data_cal = data.cal;


                updateCalendar(data, true);
                $("#end_date_label").html(data_cal['end_event']['end_date_label']);
                $("#end_date").html(data_cal['end_event']['end_date']);

                if ($(data.target).attr("data-ttname") == "None") {
                    var timetableToHide = $(e.target).attr("data-ttid");
                    $(timetableToHide).addClass(hide);
                }

                //TODO: update the list of timetables to show the new timetable.
                console.log("this is the form stuff: ", form_stuff);
                if (data['id']){
                    window.location.reload();
                    updateCalendar(data, true);
                }
                // if form_stuff has &save=true
                    //add it to the list of timetables
                    //reset and collapse the new timetable form
                //window.location.reload();

            });

            return false;
        });

        // handle the reset button:
        $('#reset2').on('click', function (e) {
            var cal = $('#calendarContainer');
            cal.fullCalendar('removeEvents');
        }); //end handler reset



        // Event handler for deleting an existing timetable
        $('.delbtn').on('click', function (e) {
            console.log("Holy crap it worked");
            console.log(e.target);
            console.log($(e.target).attr("data-ttid"));
            //probably want to add a check here to make sure they want to delete it.
            var timetableToDelete = $(e.target).attr("data-ttid");
            //send the request.
            $.post("/time_engine/delete_timetable/", {id: timetableToDelete}, function(delstuff){
                console.log(delstuff['msg'], delstuff['ttid']);
                //console.log($('e.target').closest('.panel'));
                // now remove the tt record from the dom
                console.log(e.target.parentElement.parentElement.parentElement.parentElement);
                console.log($(e.target).closest('.panel'));
                // TODO: figure out how to add a class "hide" here so I can keep it in the DOM.
                //$(e.target.parentElement.parentElement.parentElement.parentElement).addClass('hide');
                e.target.parentElement.parentElement.parentElement.parentElement.remove();


                //console.log(timetableToDelete.parent);



            }); // $.post call

        }); //delete event handler


        // event handler to display existing timetables:
        $('.displaytt').change(function(e){
           if ($(this).is(':checked')){
               // display the current stuff in the form
               // crap how do I get the current stuff?
               var timetableToDisplay = $(e.target).attr("data-ttid");
               $.get('/time_engine/get_timetable/', {id: timetableToDisplay}, function(data){
                   //this is the callback
                   //now call the display cal
                   data['elist'] = JSON.parse(data['elist']);

                   console.log("this is data", data);
{#                   for (var i = 0; i < data.length; i++){#}
{#                      console.log("this is data in the loop:", data[i].fields);#}
{#                   }#}
{#                   console.log("this is data:", data[0].fields);#}
                   updateCalendar(data, false);

               } );
{#               //updateCalendar(calJSON, false);#}
{#               console.log('checked!');#}
{#               var cal = $('#calendarContainer');#}
{#                cal.fullCalendar('removeEvents');#}
{#               console.log(cal, e);#}
                //cal.fullCalendar('addEventSource', data_cal['cal_events']);
           };
         });// event handler for displaying existing timetables

        // User authentication stuff
        // setting up the event handler for registration form submission
        $('#register-button').on('click', function (e) {
            $.post("/time_engine/register/", $('#register-form').serialize(), function (data) {
                console.log(data);
                if (!data.result) {
                    alert("Sorry: " + data.msg);
                    document.getElementById("reg_username").value = "";
                } else {
                    alert("you are now registered");
                    signinForm();
                }

            });
            return false;
        });

        // stuff to make the register modal appear
        //first get the element:

        // function to display the register form
        function regForm() {
            //show the registration form
            //add class modal-register to modal-register div
            var regDiv = document.getElementById('modal-register');
            console.log('getting the reg form div!');
            regDiv.classList.add('modal-register');
            //hide the signin
            var signinDiv = document.getElementById('modal-signin');
            signinDiv.classList.add('modal-register');
        }

        //function to display the signin form
        function signinForm() {
            //show the signin
            var signinDiv = document.getElementById('modal-signin');
            console.log('getting the signin form div!');
            signinDiv.classList.remove('modal-register');
            //hide the register form
            var regDiv = document.getElementById('modal-register');
            regDiv.classList.remove('modal-register');
            return false;
        }


        {% if not user.is_authenticated %}
            var elRegLink = document.getElementById('register-link');
            elRegLink.addEventListener('click', regForm, false);
            var elSigninLink = document.getElementById('signin-link');
            elSigninLink.addEventListener('click', signinForm, false);
        {% endif %}

    }); // end document ready


    function updateCalendar(calJSON, clearCal){
        var data_cal = calJSON['cal']; //cal is what I want to extract from calJSON....
        //clear fullCalendar of existing events.
        var cal = $('#calendarContainer');
        if (clearCal) {
            cal.fullCalendar('removeEvents');
        }
        cal.fullCalendar('addEventSource', data_cal['cal_events']);
    }

</script>
<script>
  $(function() {
    $( "#datepicker" ).datepicker({
      altField: "#alternate",
      altFormat: "DD, d MM, yy"
    });
  });
</script>


</body>

</html>
